<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.5">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="ru"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;title&gt;Перемещения учителей по Москве&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- Leaflet: фоновая карта --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;script src="https://unpkg.com/leaflet/dist/leaflet.js"&gt;&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- D3.js --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;script src="https://d3js.org/d3.v7.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>html, body { margin: 0; padding: 0; height: 100%; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#map { width: 100%; height: 100%; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>svg { position: absolute; top: 0; left: 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.arc { fill: none; stroke: steelblue; stroke-width: 2; opacity: 0.8; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;div id="map"&gt;&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Инициализация карты Москвы</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const map = L.map('map').setView([55.7558, 37.6173], 12);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Добавим слой карты OpenStreetMap</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>attribution: '&amp;copy; OpenStreetMap contributors'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}).addTo(map);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// SVG-слой поверх карты</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const svg = d3.select(map.getPanes().overlayPane).append("svg");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const g = svg.append("g").attr("class", "leaflet-zoom-hide");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Пример перемещений</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const movements = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{ from: [55.7558, 37.6173], to: [55.7600, 37.6250] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{ from: [55.7512, 37.6184], to: [55.7400, 37.6250] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{ from: [55.7700, 37.6100], to: [55.7558, 37.6173] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>function projectPoint(lat, lng) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return map.latLngToLayerPoint(new L.LatLng(lat, lng));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>function drawArcs() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const bounds = map.getBounds();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const topLeft = map.latLngToLayerPoint(bounds.getNorthWest());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const bottomRight = map.latLngToLayerPoint(bounds.getSouthEast());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>svg.attr("width", bottomRight.x - topLeft.x)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>.attr("height", bottomRight.y - topLeft.y)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>.style("left", topLeft.x + "px")</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>.style("top", topLeft.y + "px");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>g.attr("transform", `translate(${-topLeft.x},${-topLeft.y})`);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const arcs = g.selectAll("path")</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.data(movements)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.join("path")</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.attr("class", "arc")</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.attr("d", d =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const p1 = projectPoint(...d.from);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const p2 = projectPoint(...d.to);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const mx = (p1.x + p2.x) / 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const my = (p1.y + p2.y) / 2 - 30; // поднимаем для кривизны</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return `M${p1.x},${p1.y} Q${mx},${my} ${p2.x},${p2.y}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>map.on("moveend", drawArcs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>drawArcs();</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
